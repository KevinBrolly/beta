{% extends "base.html" %}
{% load aliss %}

{% block container %}
<main class="main" role="main">
    {% if not invalid_area and not errors %}
        <section id="content" class="results">
            <div class="row title">
                <div class="columns">
                    <h1>Help &amp; Support in <span class="postcode">{{ postcode.postcode }}</span></h1>
                    <div class="buttons">
                        <a href="{% url 'homepage' %}" class="button primary">Search Again</a>
                    </div>
                </div>
            </div>
        </section>
        <section id="results">
            <div class="row local-national">
                <div class="columns">
                    <h4 class="toggle-heading" id="local_national_toggle">Select Proximity</h4>
                    <div class="cells three toggled" id="local_national">
                        <a href="#" class="active">
                            <div class="holder">
                                <span class="radio"></span>
                                <span class="text">
                                    Show me all services, local and national
                                </span>
                            </div>
                        </a>
                        <a href="#">
                            <div class="holder">
                                <span class="radio"></span>
                                <span class="text">
                                    Only show the services that operate locally
                                </span>
                            </div>
                        </a>
                        <a href="#">
                            <div class="holder">
                                <span class="radio"></span>
                                <span class="text">
                                    Only show services that operate nationally
                                </span>
                            </div>
                        </a>
                    </div>
                </div>
            </div>
            <div class="row results">
                <div class="columns filters">
                    <h4 class="toggle-heading" id="filters_toggle">Customise Results</h4>
                    <div class="filter-group toggled" id="filters">
                        <div class="filter keyword-search">
                            <label>Filter by keyword:</label>
                            <div class="sbs-inputs">
                                <input type="text" placeholder="e.g. Diabetes" value="{{ request.GET.q }}">
                                <input type="submit" class="secondary" value="Search">
                            </div>
                        </div>
                        {% get_root_categories as root_categories %}
                        <div class="filter category">
                            <label>Filter by needs:</label>
                            <ul class="radio-list-links cat truncate">
                                {% for category in root_categories %}
                                    <li{% if category.name == request.GET.category %} class='active'{% endif %}>
                                        <a href="?{% query_transform request category=category.name page=None %}">
                                            <span class="radio"></span>
                                            <span class="cat">
                                                <i class="fa fa-utensil-fork"></i>
                                            </span>
                                            <span class="name">
                                                {{ category.name }}
                                            </span>
                                        </a>
                                    </li>
                                {% endfor %}
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="columns listing">
                    <ul class="search-results">
                        {% if object_list %}
                            {% for result in object_list %}
                                <li>
                                    <div class="heading">
                                        <a href="{% url 'service_report_problem' result.id %}" class="alert icon-link">
                                            <span class="icon">
                                                <i class="fas fa-exclamation-triangle"></i>
                                            </span>
                                            Report this listing
                                        </a>
                                        <a href="{% url 'service_detail' result.id %}"><h3>{{ result.name }}</h3></a>
                                    </div>
                                    <p class="org">by <a href="{% url 'organisation_detail' result.organisation.id %}">{{ result.organisation.name }}</a> <span class="claimed">Claimed</span></p>
                                    <p>{{ result.description|linebreaks }}</p>
                                    <div class="assigned-category">
                                        <span class="cat">
                                            <i class="fa fa-utensil-fork"></i>
                                        </span>
                                        <span class="name">
                                            Food
                                        </span>
                                    </div>
                                    <div class="location">
                                        <a class="icon-link">
                                            <span class="icon">
                                                <i class="fas fa-map-marker-alt"></i>
                                            </span>
                                            100 Address Street, Glasgow, G11 5LY
                                        </a>
                                    </div>
                                    <ul class="contact-info">
                                        {% if result.phone %}
                                            <li>
                                                {{ result.phone }}
                                            </li>
                                        {% endif %}
                                        {% if result.url %}
                                            <li>
                                                <a href="{{ result.url }}">Website</a>
                                            </li>
                                        {% endif %}
                                        {% if result.service_areas %}
                                            <li class="service-areas">
                                                <a>Service Areas</a>
                                            </li>
                                        {% endif %}
                                    </ul>
                                    {% if result.service_areas %}
                                        <div class="service-areas-list">
                                            <p>{% for area in result.service_areas %}{{ area.name }}{% if not forloop.last %}, {% endif %}{% endfor %}</p>
                                        </div>
                                    {% endif %}
                                </li>
                            {% endfor %}
                        {% else %}
                            <div class="error">
                                <div class="copy-container">
                                    <h2>Sorry, we couldn't find anything using those terms.</h2>
                                    <p>You can try again or start a fresh search below:</p>
                                </div>
                                <div class="buttons">
                                    <a href="{% url 'homepage' %}" class="button primary">Search again</a>
                                </div>
                            </div>
                        {% endif %}
                    </ul>
                    {% include 'partials/pagination.html' with page_obj=page_obj paginator=paginator %}
                </div>
            </div>
        </section>
        {% include 'partials/share-search.html' %}
    {% else %}
        {% if invalid_area %}
            <section id="error">
                <div class="row">
                    <div class="columns">
                        <div class="copy-container">
                            <h1>Sorry, ALISS is not available in your postcode.</h1>
                            <p>We're always adding new services to ALISS but it seems like we've not reached your area yet. Please try again with a different postcode:</p>
                        </div>
                        <div class="buttons">
                            <a href="{% url 'homepage' %}" class="button primary">Search again</a>
                        </div>
                    </div>
                </div>
            </section>
        {% endif %}
                {% if errors %}
                    {% for error in errors %}
                        {% if error == 'postcode' %}
                            <section id="error">
                                <div class="row">
                                    <div class="columns">
                                        <div class="copy-container">
                                            <h1>Sorry, {{ request.GET.postcode }} doesn't appear to be a valid postcode.</h1>
                                            <p>The postcode you entered seems to be in the wrong format, please try again:</p>
                                        </div>
                                        <div class="buttons">
                                            <a href="{% url 'homepage' %}" class="button primary">Search again</a>
                                        </div>
                                    </div>
                                </div>
                            </section>
                        {% endif %}
                    {% endfor %}
                {% endif %}
            </div>
        </div>
    {% endif %}
</main>
{% endblock %}
