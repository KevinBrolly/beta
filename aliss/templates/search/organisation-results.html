{% extends "base.html" %}
{% load aliss %}
{% load humanize %}


{% block container %}
<main class="main" role="main">
  {% if not invalid_area and not errors %}
  <section id="content" class="results">
    <div class="row title">
      <div class="columns">
        <h1>Organisations related to: <span class="postcode">{{ request.GET.query }}</span>
        </h1>
        <div class="buttons">
          <a href="{% url 'organisations' %}" class="button primary">New organisation search</a>
        </div>
      </div>
    </div>
  </section>
  {% endif %}


  <section id="results">

    <br/>
    <div class="row results">
      <div class="columns filters">
        <h4 class="toggle-heading" id="filters_toggle">Customise results</h4>
        <div class="filter-group toggled" id="filters">
          <form>
            <div class="filter keyword-search">
              <label>Filter by keyword:</label>
              <div class="sbs-inputs">
                <div class="clearable-input">
                  <i class="clear-input fas fa-times-circle" title="Clear keywords"></i>
                  <input type="text" placeholder="e.g. Diabetes" name="query" value="{{ request.GET.q }}">
                </div>
                <input type="submit" class="secondary" value="Search">
              </div>
            </div>
          </form>
        </div>
      </div>

      <div class="columns listing">
        <ul class="search-results">
          {% for result in object_list %}
          <li>
            <div class="heading">
              {% if result.slug %}
                <a href="{% url 'organisation_detail_slug' result.slug %}">
              {% else %}
                <a href="{% url 'organisation_detail' result.id %}">
              {% endif %}
              <h3>{{ result.name }}</h3></a>
            </div>
            <p>{{ result.description|linebreaks|truncatechars:150 }}</p>

            {% include 'search/partials/services.html' with services=result.services %}

            {% include 'service/partials/locations.html' with locations=result.locations %}

            <ul class="contact-info">
              {% if result.phone %}
                <li>
                  {{ result.phone }}
                </li>
              {% endif %}
              {% if result.url %}
                <li>
                  <a href="{{ result.url }}">Website</a>
                </li>
              {% endif %}
              {% if result.service_areas %}
                <li class="service-areas">
                  <a>Service Areas</a>
                </li>
              {% endif %}
            </ul>
          </li>
          {% endfor %}
        </ul>

        {% if not page_obj.has_next %}
        <div class="error">
          <div class="copy-container">
            {% if object_list %}
            <hr class="clear"/>
            <h2>Couldn't find what you were looking for?</h2>
            {% else %}
            <h2>Sorry, we couldn't find anything using those terms.</h2>
            {% endif %}
            <p>You can try searching again with different search terms.</p>
          </div>
        </div>
        {% endif %}
        {% include 'partials/pagination.html' with page=page_obj paginator=paginator %}
      </div>
    </div>
  </section>
  {% include 'partials/share-search.html' %}
</main>
{% endblock %}
