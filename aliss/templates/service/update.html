{% extends "base.html" %}

{% block container %}
<main class="main" role="main">
    <section class="grid-container" id="content">
        <div class="grid-x">
            <div class="cell small-12 medium-8">
                <h1>{{ organisation.name }}</h1>
                <div class="breadcrumbs">
                    <a href="{% url 'organisation_detail' pk=service.organisation.pk %}">{{ service.organisation.name }}</a>
                    <span class="sep"></span>
                    <span>Update Service</span>
                </div>
            </div>
        </div>

        <div class="grid-x">
            <div class="cell small-12 medium-8">
                <form method="post">
                    {% csrf_token %}
                    {% include 'service/forms/service_form.html' with organisation=organisation %}
                    <div class="submit">
                        <input type="submit" value="Update Service">
                    </div>
                </form>
            </div>
        </div>
    </section>
</main>
{% endblock %}

{% block before_body_close%}

<script type="text/javascript">
  $(document).ready(function(){

    console.log('Test')
    nationalOptGroups = []
    regionalOptGroups = []

    var nationalOptions = []
    var regionalOptions = []
    var optionGroups = $('#id_service_areas').children()

    optionGroups.each(function(index, group){
      if (group.label == "Country"){
        console.log('Group: ', group)
        nationalOptGroups.push(group)
        var groupArray = Array.from(group.children)
        $.merge(nationalOptions, groupArray)
      }
      else {
        regionalOptGroups.push(group)
        console.log('Group: ', group)
        var groupArray = Array.from(group.children)
        $.merge(regionalOptions, groupArray)
      }

    });
    console.log("National Options: ", nationalOptions)
    console.log("Regional Options: ", regionalOptions)


    function checkSelected(option){
      if (option.selected){
        return option
      }
    }

    var nationalSelectedCount = nationalOptions.filter(checkSelected).length
    var regionalSelectedCount = regionalOptions.filter(checkSelected).length

    console.log(regionalSelectedCount)
    console.log(nationalSelectedCount)

    var regionalWarning = "<h4 id=regional_warning>To add national service area remove all regional</h4>"

    var nationalWarning = "<h4 id=national_warning>To add regional service areas remove all national.</h4>"

    var mixedServiceAreaWarning = "<h4 id=national_warning>To help users please either use national OR regional service areas.</h4>"

    var serviceArealabel = $('label[for="id_service_areas"]')
    serviceArealabel.append()

    if (nationalSelectedCount == 0 && regionalSelectedCount > 0){
      optionGroups.each(function(index, element){
        if (element.label == "Country"){
          $('li[aria-label="Country"]').hide()
        }
      })
    }

    if (regionalSelectedCount == 0 && nationalSelectedCount > 0){
      regionalOptions.hide()
    }
    if (regionalSelectedCount > 0 && nationalSelectedCount > 0){
      serviceArealabel.append(mixedServiceAreaWarning)
    }

    var selectSpanTarget = {}
    $('#id_service_areas').siblings().each(function(index, item){
      if ($(item).is("span")){
        selectSpanTarget = item
      }
    })

    $(selectSpanTarget).click(function(){
      console.log('Test')
      $('li[aria-label="Country"]').hide()
      $('li[aria-label="Local Authority"]').hide()
      $('li[aria-label="Health Board"]').hide()
      $('li[aria-label="Integration Authority (HSCP)"]').hide()
    })

  });
</script>

{% endblock %}
